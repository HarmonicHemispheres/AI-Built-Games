<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plant Harvest Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 24px;
            position: relative;
        }
        #game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 10px;
            align-items: center;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(4, 110px);
            grid-template-rows: repeat(4, 110px);
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            transition: grid-template-columns 0.3s, grid-template-rows 0.3s;
        }
        .tile {
            width: 110px;
            height: 110px;
            background-color: #98fb98;
            border: 2px solid #006400;
            border-radius: 8px;
            position: relative;
            /* No background image for empty tiles */
            background-repeat: no-repeat;
            background-size: 440px 440px; /* 4 columns x 110px */
            transition: background-image 0.3s, background-position 0.3s;
        }
        .tile.ready::after {
            content: '';
            width: 20px;
            height: 20px;
            background-color: green;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        #hand {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .card {
            width: 110px;
            height: 110px;
            background-color: #fffacd;
            border: 2px solid #daa520;
            border-radius: 8px;
            cursor: grab;
            position: relative;
            background-image: url('tilemap.png');
            background-repeat: no-repeat;
            background-size: 440px 440px; /* 4 columns x 110px */
            transition: background-position 0.3s;
        }
        .card.ready::after {
            content: '';
            width: 20px;
            height: 20px;
            background-color: green;
            border-radius: 50%;
            position: absolute;
            top: 5px;
            right: 5px;
        }
        #upgrade-container {
            margin-top: 10px;
        }
        #upgrade-button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #FFD700;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #upgrade-button:hover {
            background-color: #FFC107;
        }
        #money {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 20px;
            color: #333;
        }
    </style>
</head>
<body>
    <header>
        Money: $<span id="money-count">0</span>
    </header>
    <div id="game-container">
        <div id="grid">
            <!-- Grid Tiles Generated by JavaScript -->
        </div>
        <div id="hand">
            <!-- Hand Cards Generated by JavaScript -->
        </div>
        <div id="upgrade-container">
            <button id="upgrade-button">Upgrade Garden</button>
        </div>
    </div>

    <script>
        // Sprite Configuration
        const SPRITE_SIZE = 110; // Size of each sprite in pixels
        const SPRITE_COLUMNS = 4; // Number of sprites horizontally in tilemap.png

        // Plant Definitions
        const plants = [
            { name: 'Sunflower', growthTime: 5000, spriteIndex: 0 },
            { name: 'Rose', growthTime: 7000, spriteIndex: 1 },
            { name: 'Cactus', growthTime: 10000, spriteIndex: 2 },
            { name: 'Tulip', growthTime: 6000, spriteIndex: 3 },
            { name: 'Lavender', growthTime: 8000, spriteIndex: 4 },
            { name: 'Daffodil', growthTime: 9000, spriteIndex: 5 }
            // Add more plants here with different spriteIndex values if needed
        ];

        // Game State
        let money = 0;
        let hand = [];
        const maxHandSize = 5;
        let gridSize = 4; // Initial grid size (4x4)
        const gridTiles = [];
        const timers = new Map(); // Map to keep track of timers for each tile

        // DOM Elements
        const moneyCount = document.getElementById('money-count');
        const grid = document.getElementById('grid');
        const handContainer = document.getElementById('hand');
        const upgradeButton = document.getElementById('upgrade-button');

        // Initialize Grid
        function initializeGrid() {
            for (let i = 0; i < gridSize * gridSize; i++) {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tile.dataset.index = i;
                tile.addEventListener('dragover', onDragOver);
                tile.addEventListener('drop', onDrop);
                tile.addEventListener('click', onTileClick);
                grid.appendChild(tile);
                gridTiles.push(tile);
            }
            updateGridTemplate();
        }

        // Update Grid Template Columns and Rows based on gridSize
        function updateGridTemplate() {
            grid.style.gridTemplateColumns = `repeat(${gridSize}, ${SPRITE_SIZE}px)`;
            grid.style.gridTemplateRows = `repeat(${gridSize}, ${SPRITE_SIZE}px)`;
        }

        // Initialize Hand
        function initializeHand() {
            for (let i = 0; i < maxHandSize; i++) {
                const card = createCard();
                hand.push(card);
                handContainer.appendChild(card.element);
            }
        }

        // Create a Card Element
        function createCard() {
            const plant = plants[Math.floor(Math.random() * plants.length)];
            const card = document.createElement('div');
            card.classList.add('card');
            card.draggable = true;
            card.dataset.plant = plant.name;
            card.dataset.growthTime = plant.growthTime;
            card.dataset.spriteIndex = plant.spriteIndex;
            setBackgroundPosition(card, plant.spriteIndex);
            card.addEventListener('dragstart', onDragStart);
            return { element: card, plant };
        }

        // Draw a Card if Hand is not full
        function drawCard() {
            if (hand.length < maxHandSize) {
                const card = createCard();
                hand.push(card);
                handContainer.appendChild(card.element);
            }
        }

        // Set Background Position for Plant Sprites
        function setBackgroundPosition(element, spriteIndex) {
            const row = Math.floor(spriteIndex / SPRITE_COLUMNS);
            const col = spriteIndex % SPRITE_COLUMNS;
            const x = -col * SPRITE_SIZE;
            const y = -row * SPRITE_SIZE;
            element.style.backgroundPosition = `${x}px ${y}px`;
        }

        // Drag and Drop Hand Handlers
        function onDragStart(event) {
            const cardElement = event.currentTarget;
            const handIndex = hand.findIndex(c => c.element === cardElement);
            if (handIndex === -1) return;

            const plantName = cardElement.dataset.plant;
            const growthTime = parseInt(cardElement.dataset.growthTime);
            const spriteIndex = parseInt(cardElement.dataset.spriteIndex);

            const dragData = {
                plantName,
                growthTime,
                spriteIndex,
                handIndex
            };

            event.dataTransfer.setData('application/json', JSON.stringify(dragData));
            // Optional: Set drag image if desired
            // event.dataTransfer.setDragImage(cardElement, SPRITE_SIZE / 2, SPRITE_SIZE / 2);
        }

        function onDragOver(event) {
            event.preventDefault();
        }

        function onDrop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData('application/json');
            if (!data) return;

            let dragData;
            try {
                dragData = JSON.parse(data);
            } catch (e) {
                console.error('Invalid drag data', e);
                return;
            }

            const { plantName, growthTime, spriteIndex, handIndex } = dragData;
            const tile = event.currentTarget;

            // Check if tile is empty
            if (tile.dataset.plant) {
                alert('Tile is already occupied!');
                return;
            }

            // Get the plant details
            const plant = plants.find(p => p.name === plantName);
            if (!plant) return;

            // Place the plant on the tile
            tile.dataset.plant = plant.name;
            tile.dataset.growthTime = plant.growthTime;
            tile.dataset.spriteIndex = plant.spriteIndex;
            setBackgroundPosition(tile, plant.spriteIndex);
            tile.style.backgroundImage = `url('tilemap.png')`;

            // Start the growth timer
            const timer = setTimeout(() => {
                tile.classList.add('ready');
                tile.dataset.ready = 'true';
            }, plant.growthTime);
            timers.set(tile, timer);

            // Remove the card from hand
            const card = hand[handIndex];
            if (card) {
                handContainer.removeChild(card.element);
                hand.splice(handIndex, 1);
            }

            // Draw a new card if possible
            drawCard();
        }

        // Tile Click Handler for Harvesting
        function onTileClick(event) {
            const tile = event.currentTarget;
            if (tile.classList.contains('ready')) {
                // Harvest the plant
                const harvestedPlant = tile.dataset.plant;
                const earnings = Math.floor(Math.random() * 10) + 5; // Random between 5 and 14
                money += earnings;
                updateMoney();

                // Clear the tile
                tile.classList.remove('ready');
                tile.dataset.plant = '';
                tile.dataset.growthTime = '';
                tile.dataset.spriteIndex = '';
                tile.style.backgroundImage = ''; // Remove the background image

                // Clear the timer
                if (timers.has(tile)) {
                    clearTimeout(timers.get(tile));
                    timers.delete(tile);
                }
            }
        }

        // Update Money Display
        function updateMoney() {
            moneyCount.textContent = money;
        }

        // Upgrade Garden Handler
        function upgradeGarden() {
            gridSize += 1; // Increase grid size by 1
            updateGridTemplate();

            // Calculate the total number of tiles after upgrade
            const newTotalTiles = gridSize * gridSize;
            const currentTotalTiles = gridTiles.length;

            // Add new tiles
            for (let i = currentTotalTiles; i < newTotalTiles; i++) {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tile.dataset.index = i;
                tile.addEventListener('dragover', onDragOver);
                tile.addEventListener('drop', onDrop);
                tile.addEventListener('click', onTileClick);
                grid.appendChild(tile);
                gridTiles.push(tile);
            }
        }

        // Initialize the Game
        function initializeGame() {
            initializeGrid();
            initializeHand();
            updateMoney();
        }

        // Event Listener for Upgrade Garden Button
        upgradeButton.addEventListener('click', upgradeGarden);

        // Start the game
        initializeGame();
    </script>
</body>
</html>
