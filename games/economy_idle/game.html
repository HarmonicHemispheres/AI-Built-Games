<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economy Game</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: Arial, sans-serif;
        }
        #game {
            display: grid;
            grid-template-columns: repeat(12, 50px);
            grid-template-rows: repeat(12, 50px);
            gap: 2px;
            margin-top: 20px;
            position: relative;
        }
        .tile {
            width: 50px;
            height: 50px;
            background-color: lightgray;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        .residential {
            background-color: blue;
            color: white;
        }
        .commercial {
            background-color: green;
            color: white;
        }
        .manufacturing {
            background-color: red;
            color: white;
        }
        .natural {
            background-color: brown;
            color: white;
        }
        #info {
            margin-top: 20px;
        }
        #hand {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .card {
            width: 80px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border: 1px solid #ccc;
        }
        .selected {
            border: 2px solid yellow;
        }
        .dollar {
            position: absolute;
            font-size: 20px;
            animation: riseAndFade 1s ease-out;
        }
        @keyframes riseAndFade {
            0% {
                opacity: 1;
                top: 50%;
            }
            100% {
                opacity: 0;
                top: 30%;
            }
        }
        .stock {
            position: absolute;
            bottom: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.7);
            font-size: 10px;
            padding: 2px;
        }
    </style>
</head>
<body>
    <h1>Economy Game</h1>
    <div id="info">Money: $<span id="money">100</span></div>
    <div id="game"></div>
    <div id="hand"></div>

    <script>
        let money = 100;
        const gridSize = 12;
        const gameDelay = 3000; // 3 seconds
        const tileTypes = ['residential', 'commercial', 'manufacturing', 'natural'];
        const tileEmojis = {
            residential: 'üè†',
            commercial: 'ü™ô',
            manufacturing: 'üè≠',
            natural: 'üå≥'
        };

        const hand = [];
        const tileStock = { commercial: 5 }; // Initial stock for commercial tiles
        const maxCapacity = { commercial: 10 }; // Max capacity for commercial tiles

        function updateMoney(amount) {
            money += amount;
            document.getElementById('money').innerText = money;
        }

        function getRandomTileType() {
            return tileTypes[Math.floor(Math.random() * tileTypes.length)];
        }

        function dealHand() {
            for (let i = 0; i < 4; i++) {
                hand.push(getRandomTileType());
            }
        }

        function renderHand() {
            const handContainer = document.getElementById('hand');
            handContainer.innerHTML = '';
            hand.forEach((tileType, index) => {
                const card = document.createElement('div');
                card.classList.add('card', tileType);
                card.innerText = tileEmojis[tileType];
                if (selectedHandIndex === index) {
                    card.classList.add('selected');
                }
                card.addEventListener('click', () => selectTile(tileType, index));
                handContainer.appendChild(card);
            });
        }

        function selectTile(tileType, handIndex) {
            selectedTileType = tileType;
            selectedHandIndex = handIndex;
            renderHand();
        }

        function placeBuilding(tile) {
            if (selectedTileType) {
                const type = selectedTileType;
                tile.classList.add(type);
                tile.classList.remove('tile');
                tile.innerText = tileEmojis[type];
                tile.removeEventListener('click', handleTileClick);

                if (type === 'commercial') {
                    tile.stock = tileStock.commercial;
                    const stockDiv = document.createElement('div');
                    stockDiv.classList.add('stock');
                    stockDiv.innerText = `${tile.stock}/${maxCapacity.commercial}`;
                    tile.appendChild(stockDiv);
                }

                hand.splice(selectedHandIndex, 1);
                hand.push(getRandomTileType());
                renderHand();

                selectedTileType = null;
                selectedHandIndex = null;

                setInterval(() => {
                    handleTileIncome(tile, type);
                }, gameDelay);
            }
        }

        function handleTileIncome(tile, type) {
            if (type === 'commercial') {
                const neighbors = getNeighbors(tile);
                let residentialCount = 0;
                let manufacturingCount = 0;
                neighbors.forEach(neighbor => {
                    if (neighbor.classList.contains('residential')) {
                        residentialCount++;
                    }
                    if (neighbor.classList.contains('manufacturing')) {
                        manufacturingCount++;
                    }
                });
                if (residentialCount > 0 && tile.stock > 0) {
                    showDollarAnimation(tile, residentialCount);
                    updateMoney(residentialCount);
                    tile.stock -= residentialCount;
                    updateStockDisplay(tile);
                }
                if (manufacturingCount > 0) {
                    tile.stock += manufacturingCount;
                    if (tile.stock > maxCapacity.commercial) {
                        tile.stock = maxCapacity.commercial;
                    }
                    updateStockDisplay(tile);
                }
            }
            if (type === 'manufacturing') {
                const neighbors = getNeighbors(tile);
                let naturalCount = 0;
                neighbors.forEach(neighbor => {
                    if (neighbor.classList.contains('natural')) {
                        naturalCount++;
                    }
                });
                tile.stock = (tile.stock || 0) + naturalCount;
            }
        }

        function showDollarAnimation(tile, amount) {
            const dollar = document.createElement('div');
            dollar.classList.add('dollar');
            dollar.innerText = `$${amount}`;
            tile.appendChild(dollar);
            setTimeout(() => {
                tile.removeChild(dollar);
            }, 1000);
        }

        function updateStockDisplay(tile) {
            const stockDiv = tile.querySelector('.stock');
            stockDiv.innerText = `${tile.stock}/${maxCapacity.commercial}`;
        }

        function getNeighbors(tile) {
            const index = Array.prototype.indexOf.call(tile.parentNode.children, tile);
            const neighbors = [];
            const positions = [-1, 1, -gridSize, gridSize];
            positions.forEach(pos => {
                const neighbor = tile.parentNode.children[index + pos];
                if (neighbor && !neighbor.classList.contains('tile')) {
                    neighbors.push(neighbor);
                }
            });
            return neighbors;
        }

        function handleTileClick(event) {
            const tile = event.target;
            placeBuilding(tile);
        }

        function createGrid() {
            const gameContainer = document.getElementById('game');
            for (let i = 0; i < gridSize * gridSize; i++) {
                const tile = document.createElement('div');
                tile.classList.add('tile');
                tile.addEventListener('click', handleTileClick);
                gameContainer.appendChild(tile);
            }
        }

        let selectedTileType = null;
        let selectedHandIndex = null;

        document.addEventListener('DOMContentLoaded', () => {
            createGrid();
            dealHand();
            renderHand();
        });
    </script>
</body>
</html>